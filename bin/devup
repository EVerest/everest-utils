#!/usr/bin/env bash

# Check that docker is installed
if ! command -v docker &> /dev/null
then
    echo "docker could not be found"
    exit 1
fi

if [[ -z "${EV_HOME}" ]]; then
  echo "EV_HOME is not defined"
  exit 1
else
  EVerestDevHome="${EV_HOME}"
fi

echo "EV_HOME set to ${EVerestDevHome}"

if [ ! -d "${EVerestDevHome}/everest-utils" ]; then
  echo "everest-utils is not checked out"
  exit 1
fi

echo "Attempting to create docker network infranet_network"

docker network create --driver bridge --ipv6  --subnet fd00::/80 infranet_network --attachable || true

docker compose -f "${EVerestDevHome}/everest-utils/docker/docker-compose-dev.yml" up -d mqtt-server && docker compose -f "${EVerestDevHome}/everest-utils/docker/docker-compose-dev.yml" up -d nodered
